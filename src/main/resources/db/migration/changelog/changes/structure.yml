databaseChangeLog:
  - changeSet:
      id: create-user-table
      author: kridency
      changes:
        createTable:
          tableName: user
          columns:
            - column:
                name: id
                type: uuid
                constraints:
                  primaryKey: true
                  nullable: false
            - column:
                name: email
                type: varchar
                constraints:
                  nullable: false
                  unique: true
            - column:
                name: password
                type: varchar

  - changeSet:
      id: create-roles-table
      author: kridency
      changes:
        createTable:
          tableName: user_roles
          columns:
            - column:
                name: user_id
                type: uuid
                constraints:
                  primaryKey: true
                  foreignKeyName: fk_roles_user
                  references: user(id)
                  nullable: false
            - column:
                name: roles
                type: role_type
                constraints:
                  primaryKey: true
                  nullable: false

  - changeSet:
      id: create-card-table
      author: kridency
      changes:
        createTable:
          tableName: card
          columns:
            - column:
                name: id
                type: uuid
                constraints:
                  primaryKey: true
                  nullable: false
            - column:
                name: account
                type: varchar(255)
                constraints:
                  nullable: false
                  unique: true
            - column:
                name: expiry_date
                type: date
                valueDate: date_trunc('month', expiry_date)
                constraints:
                  nullable: false
            - column:
                name: owner
                type: uuid
                constraints:
                  foreignKeyName: fk_card_owner
                  references: user(id)
                  nullable: false
            - column:
                name: status
                type: status_type
                constraints:
                  nullable: false
            - column:
                name: balance
                type: number

  - changeSet:
      id: create-refresh-token-table
      author: kridency
      changes:
        createTable:
          tableName: refresh_token
          columns:
            - column:
                name: id
                type: uuid
                constraints:
                  primaryKey: true
                  nullable: false
            - column:
                name: token
                type: varchar
                constraints:
                  nullable: false
            - column:
                name: issue_date
                type: timestamp
                defaultValueComputed: now()
                constraints:
                  nullable: false
            - column:
                name: expiry_date
                type: timestamp
                defaultValueComputed: now() + interval '${refreshTokenLifetime} minute'
                constraints:
                  nullable: false